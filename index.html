<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ប្រព័ន្ធគ្រប់គ្រងមូលដ្ឋានទិន្នន័យនិស្សិត</title>
    
    <!-- Khmer Font -->
    <link href="https://fonts.googleapis.com/css2?family=Battambang:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom Styles -->
    <style>
        :root {
            --primary-color: #0d47a1;
            --secondary-color: #1976d2;
            --accent-color: #f50057;
            --success-color: #00c853;
            --warning-color: #ffbb33;
            --danger-color: #ff4444;
            --light-color: #f8f9fa;
            --dark-color: #212121;
            --khmer-font: 'Battambang', sans-serif;
        }
        
        * {
            font-family: var(--khmer-font), sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            min-height: 100vh;
        }
        
        .khmer-text {
            font-family: var(--khmer-font), sans-serif;
            line-height: 1.6;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        }
        
        .card-shadow {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .card-shadow:hover {
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
            transform: translateY(-5px);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(25, 118, 210, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #d32f2f 0%, #f44336 100%);
            transition: all 0.3s ease;
        }
        
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(244, 67, 54, 0.4);
        }
        
        .floating {
            animation: floating 3s ease-in-out infinite;
        }
        
        @keyframes floating {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        .slide-up {
            animation: slideUp 0.5s ease-out;
        }
        
        @keyframes slideUp {
            0% { transform: translateY(20px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(13, 71, 161, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(13, 71, 161, 0); }
            100% { box-shadow: 0 0 0 0 rgba(13, 71, 161, 0); }
        }
        
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 10px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-color);
        }
        
        .loader {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid white;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .admin-card {
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .student-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }
        
        .student-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }
        
        .nav-item {
            transition: all 0.3s ease;
        }
        
        .nav-item.active {
            color: var(--primary-color);
            background-color: rgba(13, 71, 161, 0.1);
        }
        
        .nav-item:hover {
            background-color: rgba(13, 71, 161, 0.05);
        }
        
        .tab-indicator {
            position: absolute;
            bottom: 0;
            height: 3px;
            background-color: var(--primary-color);
            transition: all 0.3s ease;
        }
        
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }
        
        .search-input {
            background-color: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .camera-container {
            background-color: black;
            position: relative;
            overflow: hidden;
        }
        
        .camera-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .focus-frame {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            height: 80%;
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: 10px;
        }
        
        .focus-corner {
            position: absolute;
            width: 20px;
            height: 20px;
            border-color: rgba(255, 255, 255, 0.8);
            border-style: solid;
        }
        
        .focus-corner.tl {
            top: -2px;
            left: -2px;
            border-width: 2px 0 0 2px;
            border-top-left-radius: 5px;
        }
        
        .focus-corner.tr {
            top: -2px;
            right: -2px;
            border-width: 2px 2px 0 0;
            border-top-right-radius: 5px;
        }
        
        .focus-corner.bl {
            bottom: -2px;
            left: -2px;
            border-width: 0 0 2px 2px;
            border-bottom-left-radius: 5px;
        }
        
        .focus-corner.br {
            bottom: -2px;
            right: -2px;
            border-width: 0 2px 2px 0;
            border-bottom-right-radius: 5px;
        }
        
        .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--accent-color);
            color: white;
            font-size: 10px;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .notification-dot {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 8px;
            height: 8px;
            background-color: var(--accent-color);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .student-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
        }
        
        .student-avatar {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            overflow: hidden;
            position: relative;
            flex-shrink: 0;
        }
        
        .student-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
        }
        
        .student-avatar .placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 24px;
            font-weight: bold;
        }
        
        @media (max-width: 640px) {
            .mobile-padding {
                padding: 1rem;
            }
            
            .mobile-text {
                font-size: 0.875rem;
            }
            
            .mobile-card {
                border-radius: 10px;
            }
            
            .student-avatar {
                width: 56px;
                height: 56px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Babel Standalone for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- React Components (now included in the same file) -->
    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAc2g-t9A7du3K_nI2fJnw_OGxhmLfpP6s",
            authDomain: "dilistname.firebaseapp.com",
            databaseURL: "https://dilistname-default-rtdb.firebaseio.com",
            projectId: "dilistname",
            storageBucket: "dilistname.firebasestorage.app",
            messagingSenderId: "897983357871",
            appId: "1:897983357871:web:42a046bc9fb3e0543dc55a",
            measurementId: "G-NQ798D9J6K"
        };

        // Cloudinary configuration
        const CLOUDINARY_URL = "https://api.cloudinary.com/v1_1/dttx1x743/image/upload";
        const CLOUDINARY_PRESET = "difulllist";

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.database();

        // Utility function to get proper image URL
        const getImageUrl = (imageUrl) => {
            if (!imageUrl || imageUrl === 'n/a' || imageUrl === "") {
                return null;
            }
            
            // Handle different image types and formats
            if (imageUrl.startsWith('http')) {
                return imageUrl;
            }
            
            if (imageUrl.startsWith('data:')) {
                return imageUrl;
            }
            
            // If it's a relative path, convert to absolute
            if (imageUrl.startsWith('/')) {
                return imageUrl;
            }
            
            // Default case
            return imageUrl;
        };

        // Utility function to get student initials for avatar
        const getStudentInitials = (name) => {
            if (!name) return '?';
            
            const khmerName = name.trim();
            if (khmerName.length <= 2) {
                return khmerName.toUpperCase();
            }
            
            // For Khmer names, take first 2 characters
            return khmerName.substring(0, 2).toUpperCase();
        };

        // Utility function to check if image is valid
        const isValidImage = (url) => {
            if (!url) return false;
            return url.startsWith('http') || url.startsWith('data:') || url.startsWith('/');
        };

        // Main App Component
        const App = () => {
            // State variables
            const [currentAdmin, setCurrentAdmin] = useState({ id: null, name: 'មិនស្គាល់', verified: false });
            const [activeStudentId, setActiveStudentId] = useState(null);
            const [activeStudentName, setActiveStudentName] = useState("");
            const [capturedBlob, setCapturedBlob] = useState(null);
            const [videoStream, setVideoStream] = useState(null);
            const [currentTab, setCurrentTab] = useState('home');
            const [allStudents, setAllStudents] = useState([]);
            const [filteredStudents, setFilteredStudents] = useState([]);
            const [searchQuery, setSearchQuery] = useState("");
            const [isLoading, setIsLoading] = useState(true);
            const [isCameraOpen, setIsCameraOpen] = useState(false);
            const [isPreviewOpen, setIsPreviewOpen] = useState(false);
            const [isDeleteModalOpen, setIsDeleteModalOpen] = useState(false);
            const [isSuccessModalOpen, setIsSuccessModalOpen] = useState(false);
            const [isUploading, setIsUploading] = useState(false);
            const [adminLogs, setAdminLogs] = useState([]);
            const [isMirrored, setIsMirrored] = useState(true);
            const [showBackToTop, setShowBackToTop] = useState(false);
            const [imageErrors, setImageErrors] = useState({});
            
            // Refs
            const videoRef = useRef(null);
            const canvasRef = useRef(null);
            
            // Constants
            const ALLOWED_ADMIN_IDS = ['250', '246', '249', '247', '273', '169'];
            
            // Check for saved admin session on component mount
            useEffect(() => {
                const savedId = localStorage.getItem('adminId');
                const savedName = localStorage.getItem('adminName');
                
                if (savedId && savedName) {
                    setCurrentAdmin({ id: savedId, name: savedName, verified: true });
                }
                
                // Add scroll event listener
                window.addEventListener('scroll', handleScroll);
                
                return () => {
                    window.removeEventListener('scroll', handleScroll);
                };
            }, []);
            
            // Fetch all students data when admin is verified
            useEffect(() => {
                if (currentAdmin.verified) {
                    fetchAllStudents();
                    fetchAdminLogs();
                }
            }, [currentAdmin.verified]);
            
            // Filter students based on search query and current tab
            useEffect(() => {
                let filtered = [...allStudents];
                
                // Apply search filter
                if (searchQuery) {
                    const query = searchQuery.toLowerCase();
                    filtered = filtered.filter(student => 
                        student.id.toString().includes(query) || 
                        (student['ឈ្មោះ'] || "").toLowerCase().includes(query)
                    );
                }
                
                // Apply tab-specific sorting
                if (currentTab === 'missing') {
                    filtered.sort((a, b) => {
                        const aMissing = !isValidImage(a['រូបថត']);
                        const bMissing = !isValidImage(b['រូបថត']);
                        return bMissing - aMissing;
                    });
                } else if (currentTab === 'delete') {
                    filtered.sort((a, b) => {
                        const aHasImage = isValidImage(a['រូបថត']);
                        const bHasImage = isValidImage(b['រូបថត']);
                        return bHasImage - aHasImage;
                    });
                } else {
                    filtered.sort((a, b) => a.id - b.id);
                }
                
                setFilteredStudents(filtered);
            }, [allStudents, searchQuery, currentTab]);
            
            // Handle scroll event
            const handleScroll = () => {
                setShowBackToTop(window.scrollY > 300);
            };
            
            // Scroll to top
            const scrollToTop = () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };
            
            // Handle image error
            const handleImageError = (studentId) => {
                setImageErrors(prev => ({ ...prev, [studentId]: true }));
            };
            
            // Fetch all students from Firebase
            const fetchAllStudents = () => {
                setIsLoading(true);
                db.ref('students').orderByKey().once('value').then(snapshot => {
                    const students = [];
                    if (snapshot.exists()) {
                        snapshot.forEach(child => {
                            students.push({ id: child.key, ...child.val() });
                        });
                    }
                    setAllStudents(students);
                    setIsLoading(false);
                }).catch(error => {
                    console.error("Error fetching students:", error);
                    setIsLoading(false);
                });
            };
            
            // Fetch admin logs from Firebase
            const fetchAdminLogs = () => {
                if (!currentAdmin.id) return;
                
                db.ref('admin_logs/' + currentAdmin.id).limitToLast(50).on('value', snapshot => {
                    const logs = [];
                    if (snapshot.exists()) {
                        snapshot.forEach(child => {
                            logs.push({ key: child.key, ...child.val() });
                        });
                    }
                    setAdminLogs(logs.reverse());
                });
            };
            
            // Handle admin login
            const handleLogin = (adminId) => {
                if (!ALLOWED_ADMIN_IDS.includes(adminId)) {
                    alert("មិនអនុញ្ញាតឱ្យចូល។ លេខសម្គាល់អ្នកគ្រប់គ្រងមិនត្រឹមត្រូវ។");
                    return;
                }
                
                db.ref('students/' + adminId).once('value').then(snapshot => {
                    if (snapshot.exists()) {
                        const data = snapshot.val();
                        const admin = {
                            id: adminId,
                            name: data['ឈ្មោះ'] || `អ្នកគ្រប់គ្រង ${adminId}`,
                            verified: true
                        };
                        
                        setCurrentAdmin(admin);
                        localStorage.setItem('adminId', admin.id);
                        localStorage.setItem('adminName', admin.name);
                    } else {
                        alert("រកមិនឃើញលេខសម្គាល់អ្នកគ្រប់គ្រងនៅក្នុងមូលដ្ឋានទិន្នន័យ។");
                    }
                }).catch(error => {
                    console.error("Error verifying admin:", error);
                    alert("កំហុសក្នុងការផ្ទៀងផ្ទាត់អ្នកគ្រប់គ្រង។ សូមព្យាយាមម្ដងទៀត។");
                });
            };
            
            // Handle admin logout
            const handleLogout = () => {
                if (confirm("តើអ្នកប្រាកដជាចង់ចាកចេញឬ?")) {
                    localStorage.removeItem('adminId');
                    localStorage.removeItem('adminName');
                    setCurrentAdmin({ id: null, name: 'មិនស្គាល់', verified: false });
                }
            };
            
            // Delete admin log entry
            const deleteLog = (logId) => {
                if (confirm("លុបធាតុក្នុងកំណត់ហេតុនេះ?")) {
                    db.ref('admin_logs/' + currentAdmin.id + '/' + logId).remove()
                        .catch(error => console.error("Error deleting log:", error));
                }
            };
            
            // Open camera for photo capture
            const openCamera = (studentId, studentName) => {
                setActiveStudentId(studentId);
                setActiveStudentName(studentName);
                setIsCameraOpen(true);
                startCamera();
            };
            
            // Start camera stream
            const startCamera = () => {
                navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
                    .then(stream => {
                        setVideoStream(stream);
                        if (videoRef.current) {
                            videoRef.current.srcObject = stream;
                        }
                    })
                    .catch(error => {
                        console.error("Error accessing camera:", error);
                        alert("កំហុសក្នុងការចូលដំណើរការកាមេរ៉ា។ សូមពិនិត្យសិទ្ធិ។");
                        setIsCameraOpen(false);
                    });
            };
            
            // Toggle camera mirror effect
            const toggleMirror = () => {
                setIsMirrored(!isMirrored);
            };
            
            // Close camera
            const closeCamera = () => {
                if (videoStream) {
                    videoStream.getTracks().forEach(track => track.stop());
                    setVideoStream(null);
                }
                setIsCameraOpen(false);
            };
            
            // Capture photo from video stream
            const capturePhoto = () => {
                if (!videoRef.current || !canvasRef.current) return;
                
                const video = videoRef.current;
                const canvas = canvasRef.current;
                const size = Math.min(video.videoWidth, video.videoHeight);
                
                canvas.width = size;
                canvas.height = size;
                
                const context = canvas.getContext('2d');
                
                if (isMirrored) {
                    context.translate(size, 0);
                    context.scale(-1, 1);
                }
                
                context.drawImage(
                    video,
                    (video.videoWidth - size) / 2,
                    (video.videoHeight - size) / 2,
                    size,
                    size,
                    0,
                    0,
                    size,
                    size
                );
                
                // Convert to blob for upload
                canvas.toBlob((blob) => {
                    if (blob) {
                        const reader = new FileReader();
                        reader.onloadend = () => {
                            setCapturedBlob(reader.result);
                        };
                        reader.readAsDataURL(blob);
                    }
                }, 'image/jpeg', 0.8);
                
                closeCamera();
                setIsPreviewOpen(true);
            };
            
            // Upload photo to Cloudinary and update Firebase
            const uploadPhoto = () => {
                if (!capturedBlob) return;
                
                setIsUploading(true);
                
                // Convert data URL to blob
                const byteString = atob(capturedBlob.split(',')[1]);
                const mimeString = capturedBlob.split(',')[0].split(':')[1].split(';')[0];
                const ab = new ArrayBuffer(byteString.length);
                const ia = new Uint8Array(ab);
                
                for (let i = 0; i < byteString.length; i++) {
                    ia[i] = byteString.charCodeAt(i);
                }
                
                const blob = new Blob([ab], { type: mimeString });
                
                const formData = new FormData();
                formData.append('file', blob);
                formData.append('upload_preset', CLOUDINARY_PRESET);
                
                fetch(CLOUDINARY_URL, {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.secure_url) {
                        updateStudentPhoto(data.secure_url);
                    } else {
                        throw new Error("Upload failed");
                    }
                })
                .catch(error => {
                    console.error("Error uploading photo:", error);
                    alert("កំហុសក្នុងការផ្ទុកឡើងរូបភាព។ សូមព្យាយាមម្ដងទៀត។");
                    setIsUploading(false);
                });
            };
            
            // Update student photo in Firebase
            const updateStudentPhoto = (photoUrl) => {
                db.ref('students/' + activeStudentId).update({ 'រូបថត': photoUrl })
                    .then(() => {
                        // Log the action if admin is verified
                        if (currentAdmin.verified) {
                            db.ref('admin_logs/' + currentAdmin.id).push({
                                adminId: String(currentAdmin.id),
                                adminName: currentAdmin.name,
                                studentId: activeStudentId,
                                studentName: activeStudentName,
                                timestamp: firebase.database.ServerValue.TIMESTAMP
                            });
                        }
                        
                        // Update local state
                        const updatedStudents = allStudents.map(student => 
                            student.id === activeStudentId 
                                ? { ...student, 'រូបថត': photoUrl }
                                : student
                        );
                        setAllStudents(updatedStudents);
                        
                        // Clear image error for this student
                        setImageErrors(prev => {
                            const newErrors = { ...prev };
                            delete newErrors[activeStudentId];
                            return newErrors;
                        });
                        
                        // Close preview and show success message
                        setIsUploading(false);
                        setIsPreviewOpen(false);
                        setIsSuccessModalOpen(true);
                        
                        setTimeout(() => {
                            setIsSuccessModalOpen(false);
                        }, 2000);
                    })
                    .catch(error => {
                        console.error("Error updating photo:", error);
                        alert("កំហុសក្នុងការធ្វើបច្ចុប្បន្នភាពរូបភាព។ សូមព្យាយាមម្ដងទៀត។");
                        setIsUploading(false);
                    });
            };
            
            // Retake photo
            const retakePhoto = () => {
                setIsPreviewOpen(false);
                openCamera(activeStudentId, activeStudentName);
            };
            
            // Close preview modal
            const closePreview = () => {
                setIsPreviewOpen(false);
            };
            
            // Open delete confirmation modal
            const openDeleteModal = (studentId, studentName) => {
                setActiveStudentId(studentId);
                setActiveStudentName(studentName);
                setIsDeleteModalOpen(true);
            };
            
            // Close delete modal
            const closeDeleteModal = () => {
                setIsDeleteModalOpen(false);
            };
            
            // Confirm and delete student photo
            const confirmDeletePhoto = () => {
                db.ref('students/' + activeStudentId).update({ 'រូបថត': "" })
                    .then(() => {
                        // Update local state
                        const updatedStudents = allStudents.map(student => 
                            student.id === activeStudentId 
                                ? { ...student, 'រូបថត': "" }
                                : student
                        );
                        setAllStudents(updatedStudents);
                        
                        // Clear image error for this student
                        setImageErrors(prev => {
                            const newErrors = { ...prev };
                            delete newErrors[activeStudentId];
                            return newErrors;
                        });
                        
                        // Close modal
                        closeDeleteModal();
                    })
                    .catch(error => {
                        console.error("Error deleting photo:", error);
                        alert("កំហុសក្នុងការលុបរូបភាព។ សូមព្យាយាមម្ដងទៀត។");
                    });
            };
            
            // Count students with missing photos
            const missingPhotosCount = allStudents.filter(student => 
                !isValidImage(student['រូបថត'])
            ).length;
            
            // Render login screen
            if (!currentAdmin.verified) {
                return <LoginScreen onLogin={handleLogin} />;
            }
            
            // Render main app
            return (
                <div className="min-h-screen bg-gray-50 flex flex-col">
                    {/* Header */}
                    <Header currentTab={currentTab} />
                    
                    {/* Main Content */}
                    <main className="flex-grow pb-20">
                        {/* Admin Panel */}
                        {currentTab === 'admin' && (
                            <AdminPanel 
                                admin={currentAdmin} 
                                logs={adminLogs} 
                                onLogout={handleLogout} 
                                onDeleteLog={deleteLog} 
                            />
                        )}
                        
                        {/* Search Bar */}
                        {(currentTab === 'home' || currentTab === 'missing' || currentTab === 'delete') && (
                            <SearchBar 
                                query={searchQuery} 
                                onChange={setSearchQuery} 
                                placeholder={
                                    currentTab === 'home' ? "ស្វែងរកតាមឈ្មោះ ឬ ID..." :
                                    currentTab === 'missing' ? "ស្វែងរកនិស្សិតដែលមិនទាន់មានរូប..." :
                                    "ស្វែងរកដើម្បីលុបរូបភាព..."
                                } 
                            />
                        )}
                        
                        {/* Filter Banner for Missing Photos */}
                        {currentTab === 'missing' && (
                            <FilterBanner 
                                type="missing" 
                                count={missingPhotosCount} 
                            />
                        )}
                        
                        {/* Student List */}
                        {(currentTab === 'home' || currentTab === 'missing' || currentTab === 'delete') && (
                            <StudentList 
                                students={filteredStudents} 
                                isLoading={isLoading}
                                currentTab={currentTab}
                                onOpenCamera={openCamera}
                                onOpenDeleteModal={openDeleteModal}
                                imageErrors={imageErrors}
                                onImageError={handleImageError}
                            />
                        )}
                    </main>
                    
                    {/* Bottom Navigation */}
                    <BottomNavigation 
                        currentTab={currentTab} 
                        onTabChange={setCurrentTab} 
                        missingCount={missingPhotosCount} 
                    />
                    
                    {/* Camera Modal */}
                    {isCameraOpen && (
                        <CameraModal 
                            videoRef={videoRef}
                            canvasRef={canvasRef}
                            isMirrored={isMirrored}
                            onClose={closeCamera}
                            onCapture={capturePhoto}
                            onToggleMirror={toggleMirror}
                        />
                    )}
                    
                    {/* Preview Modal */}
                    {isPreviewOpen && (
                        <PreviewModal 
                            image={capturedBlob}
                            studentName={activeStudentName}
                            isUploading={isUploading}
                            onClose={closePreview}
                            onConfirm={uploadPhoto}
                            onRetake={retakePhoto}
                        />
                    )}
                    
                    {/* Delete Confirmation Modal */}
                    {isDeleteModalOpen && (
                        <DeleteModal 
                            studentName={activeStudentName}
                            onClose={closeDeleteModal}
                            onConfirm={confirmDeletePhoto}
                        />
                    )}
                    
                    {/* Success Modal */}
                    {isSuccessModalOpen && (
                        <SuccessModal />
                    )}
                    
                    {/* Back to Top Button */}
                    {showBackToTop && (
                        <button 
                            onClick={scrollToTop}
                            className="fixed bottom-24 right-5 z-30 bg-indigo-600 text-white w-12 h-12 flex items-center justify-center rounded-full shadow-lg transition-all duration-300 hover:bg-indigo-700 active:scale-90"
                        >
                            <i className="fas fa-arrow-up"></i>
                        </button>
                    )}
                </div>
            );
        };

        // Login Screen Component
        const LoginScreen = ({ onLogin }) => {
            const [adminId, setAdminId] = useState("");
            const [isSubmitting, setIsSubmitting] = useState(false);
            
            const handleSubmit = (e) => {
                e.preventDefault();
                if (!adminId) {
                    alert("សូមបញ្ចូលលេខសម្គាល់អ្នកគ្រប់គ្រង");
                    return;
                }
                
                setIsSubmitting(true);
                onLogin(adminId);
                setIsSubmitting(false);
            };
            
            return (
                <div className="fixed inset-0 z-50 bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 flex items-center justify-center p-6">
                    <div className="max-w-md w-full">
                        <div className="bg-white/10 backdrop-blur-md rounded-3xl p-8 shadow-2xl border border-white/20">
                            <div className="text-center mb-8">
                                <div className="w-24 h-24 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-6 floating">
                                    <i className="fas fa-user-shield text-4xl text-white"></i>
                                </div>
                                <h2 className="text-3xl font-bold text-white mb-2 khmer-text">ចូលប្រព័ន្ធគ្រប់គ្រង</h2>
                                <p className="text-white/70 khmer-text">ប្រព័ន្ធគ្រប់គ្រងមូលដ្ឋានទិន្នន័យនិស្សិត</p>
                            </div>
                            
                            <form onSubmit={handleSubmit} className="space-y-6">
                                <div>
                                    <label htmlFor="adminId" className="block text-sm font-medium text-white/80 mb-2 khmer-text">
                                        លេខសម្គាល់អ្នកគ្រប់គ្រង
                                    </label>
                                    <div className="relative">
                                        <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <i className="fas fa-fingerprint text-white/50"></i>
                                        </div>
                                        <input
                                            type="text"
                                            id="adminId"
                                            value={adminId}
                                            onChange={(e) => setAdminId(e.target.value)}
                                            className="block w-full pl-10 pr-3 py-3 bg-white/10 border border-white/20 rounded-xl text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-white/50 focus:border-transparent khmer-text"
                                            placeholder="បញ្ចូលលេខសម្គាល់អ្នកគ្រប់គ្រងរបស់អ្នក"
                                        />
                                    </div>
                                </div>
                                
                                <button
                                    type="submit"
                                    disabled={isSubmitting}
                                    className="w-full bg-white text-indigo-900 font-bold py-3 px-4 rounded-xl shadow-lg hover:bg-white/90 focus:outline-none focus:ring-2 focus:ring-white/50 transition-all duration-200 flex items-center justify-center khmer-text"
                                >
                                    {isSubmitting ? (
                                        <>
                                            <div className="loader mr-2"></div>
                                            កំពុងផ្ទៀងផ្ទាត់...
                                        </>
                                    ) : (
                                        <>
                                            <i className="fas fa-sign-in-alt mr-2"></i>
                                            ចូល
                                        </>
                                    )}
                                </button>
                            </form>
                            
                            <div className="mt-8 text-center">
                                <p className="text-white/50 text-sm khmer-text">
                                    ប្រព័ន្ធនេះសម្រាប់តែបុគ្គលិកដែលមានការអនុញ្ញាតតែប៉ុណ្ណោះ។
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Header Component
        const Header = ({ currentTab }) => {
            const getHeaderClass = () => {
                switch (currentTab) {
                    case 'delete':
                        return 'bg-gradient-to-r from-red-600 to-red-500';
                    case 'admin':
                        return 'bg-gray-900';
                    default:
                        return 'bg-gradient-to-r from-indigo-600 to-cyan-500';
                }
            };
            
            return (
                <header className={`${getHeaderClass()} shadow-lg sticky top-0 z-40 transition-all duration-500`}>
                    <div className="max-w-4xl mx-auto px-4 py-4 flex items-center justify-between">
                        <div className="flex items-center gap-4">
                            <div className="w-12 h-12 bg-white rounded-xl flex items-center justify-center shadow-lg">
                                <img src="https://i.postimg.cc/FHBn0Fdf/di3-copy.png" alt="Logo" className="w-full h-full object-contain rounded-lg" />
                            </div>
                            <div className="text-white">
                                <h1 className="font-bold text-xl leading-none tracking-wide khmer-text">មូលដ្ឋានទិន្នន័យនិស្សិត</h1>
                                <p className="text-white/70 text-xs uppercase tracking-wider font-medium mt-1 khmer-text">
                                    {currentTab === 'home' ? 'និស្សិតទាំងអស់' :
                                     currentTab === 'missing' ? 'រូបថតដែលរង់ចាំ' :
                                     currentTab === 'delete' ? 'លុបរូបភាព' :
                                     'ផ្ទាំងគ្រប់គ្រង'}
                                </p>
                            </div>
                        </div>
                        
                        <div className="text-white/70 text-sm font-medium">
                            {new Date().toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })}
                        </div>
                    </div>
                </header>
            );
        };

        // Search Bar Component
        const SearchBar = ({ query, onChange, placeholder }) => {
            return (
                <div className="sticky top-[80px] z-30 bg-white shadow-sm px-4 py-3">
                    <div className="max-w-4xl mx-auto">
                        <div className="relative">
                            <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i className="fas fa-search text-gray-400"></i>
                            </div>
                            <input
                                type="text"
                                value={query}
                                onChange={(e) => onChange(e.target.value)}
                                className="block w-full pl-10 pr-4 py-3 bg-gray-50 border border-gray-200 rounded-xl text-gray-700 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent khmer-text"
                                placeholder={placeholder}
                            />
                        </div>
                    </div>
                </div>
            );
        };

        // Filter Banner Component
        const FilterBanner = ({ type, count }) => {
            const getBannerClass = () => {
                switch (type) {
                    case 'missing':
                        return 'bg-amber-50 border-l-4 border-amber-400';
                    default:
                        return 'bg-blue-50 border-l-4 border-blue-400';
                }
            };
            
            const getIconClass = () => {
                switch (type) {
                    case 'missing':
                        return 'text-amber-600';
                    default:
                        return 'text-blue-600';
                }
            };
            
            const getTextClass = () => {
                switch (type) {
                    case 'missing':
                        return 'text-amber-800';
                    default:
                        return 'text-blue-800';
                }
            };
            
            return (
                <div className={`max-w-4xl mx-auto px-4 py-3 ${getBannerClass()} rounded-r-xl flex items-center justify-between`}>
                    <div className="flex items-center gap-3">
                        <div className={`w-10 h-10 rounded-full bg-white flex items-center justify-center ${getIconClass()}`}>
                            <i className="fas fa-exclamation-triangle"></i>
                        </div>
                        <div>
                            <p className={`font-bold text-sm ${getTextClass()} khmer-text`}>រូបថតដែលបាត់</p>
                            <p className={`text-xs ${getTextClass()} opacity-80 khmer-text`}>និស្សិតដែលមិនមានរូបថត</p>
                        </div>
                    </div>
                    <span className="bg-white px-3 py-1 rounded-full text-sm font-bold text-gray-700">
                        {count}
                    </span>
                </div>
            );
        };

        // Student List Component
        const StudentList = ({ students, isLoading, currentTab, onOpenCamera, onOpenDeleteModal, imageErrors, onImageError }) => {
            if (isLoading) {
                return (
                    <div className="max-w-4xl mx-auto px-4 py-8">
                        <div className="flex justify-center items-center h-64">
                            <div className="text-center">
                                <div className="loader mx-auto mb-4"></div>
                                <p className="text-gray-500 font-medium khmer-text">កំពុងផ្ទុកទិន្នន័យនិស្សិត...</p>
                            </div>
                        </div>
                    </div>
                );
            }
            
            if (students.length === 0) {
                return (
                    <div className="max-w-4xl mx-auto px-4 py-8">
                        <div className="text-center py-16">
                            <div className="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i className="fas fa-search text-3xl text-gray-400"></i>
                            </div>
                            <h3 className="text-xl font-semibold text-gray-700 mb-2 khmer-text">រកមិនឃើញនិស្សិត</h3>
                            <p className="text-gray-500 khmer-text">សូមព្យាយាមលៃតម្រូវការស្វែងរក ឬតម្រងរបស់អ្នក</p>
                        </div>
                    </div>
                );
            }
            
            return (
                <div className="max-w-4xl mx-auto px-4 py-4">
                    <div className="flex justify-between items-center mb-4">
                        <h2 className="text-lg font-semibold text-gray-700 khmer-text">
                            {currentTab === 'home' ? 'និស្សិតទាំងអស់' :
                             currentTab === 'missing' ? 'និស្សិតដែលមិនមានរូបថត' :
                             'និស្សិតដែលមានរូបថត'}
                        </h2>
                        <span className="bg-gray-100 text-gray-600 px-3 py-1 rounded-full text-sm font-medium">
                            {students.length} និស្សិត
                        </span>
                    </div>
                    
                    <div className="space-y-3">
                        {students.map(student => (
                            <StudentCard 
                                key={student.id} 
                                student={student} 
                                currentTab={currentTab}
                                onOpenCamera={onOpenCamera}
                                onOpenDeleteModal={onOpenDeleteModal}
                                imageError={imageErrors[student.id]}
                                onImageError={() => onImageError(student.id)}
                            />
                        ))}
                    </div>
                </div>
            );
        };

        // Student Card Component
        const StudentCard = ({ student, currentTab, onOpenCamera, onOpenDeleteModal, imageError, onImageError }) => {
            const imageUrl = getImageUrl(student['រូបថត']);
            const hasImage = isValidImage(student['រូបថត']) && !imageError;
            
            const handleCardClick = () => {
                if (currentTab === 'home' && !hasImage) {
                    onOpenCamera(student.id, student['ឈ្មោះ']);
                }
            };
            
            return (
                <div className="bg-white rounded-xl shadow-sm border border-gray-100 p-4 flex items-center gap-4 hover:shadow-md transition-shadow active:scale-[0.99]">
                    <div 
                        className={`student-avatar border-2 ${hasImage ? 'border-green-500' : 'border-gray-200'} ${!hasImage && currentTab === 'home' ? 'cursor-pointer' : ''}`}
                        onClick={handleCardClick}
                    >
                        {hasImage ? (
                            <img 
                                src={imageUrl} 
                                alt={student['ឈ្មោះ']} 
                                className="student-image"
                                onError={onImageError}
                            />
                        ) : (
                            <div className="placeholder">
                                {getStudentInitials(student['ឈ្មោះ'])}
                            </div>
                        )}
                    </div>
                    
                    <div className="flex-grow min-w-0">
                        <h3 className="font-semibold text-gray-800 text-lg truncate khmer-text">{student['ឈ្មោះ'] || "មិនស្គាល់"}</h3>
                        <p className="text-sm text-gray-500 mb-1 truncate khmer-text">{student['ជំនាញ'] || "ទូទៅ"}</p>
                        <div className="inline-flex items-center bg-indigo-100 text-indigo-700 px-2 py-0.5 rounded-md text-xs font-medium">
                            ID: {student.id}
                        </div>
                    </div>
                    
                    <div className="flex-shrink-0">
                        {currentTab === 'delete' ? (
                            hasImage ? (
                                <button 
                                    onClick={() => onOpenDeleteModal(student.id, student['ឈ្មោះ'])}
                                    className="w-10 h-10 bg-red-50 text-red-500 rounded-full flex items-center justify-center hover:bg-red-100 transition-colors"
                                >
                                    <i className="fas fa-trash-alt"></i>
                                </button>
                            ) : (
                                <div className="w-10 h-10 bg-gray-100 text-gray-400 rounded-full flex items-center justify-center">
                                    <i className="fas fa-ban"></i>
                                </div>
                            )
                        ) : (
                            hasImage ? (
                                <div className="w-10 h-10 bg-green-50 text-green-500 rounded-full flex items-center justify-center">
                                    <i className="fas fa-check"></i>
                                </div>
                            ) : (
                                <button 
                                    onClick={() => onOpenCamera(student.id, student['ឈ្មោះ'])}
                                    className="w-10 h-10 bg-indigo-600 text-white rounded-full flex items-center justify-center hover:bg-indigo-700 transition-colors"
                                >
                                    <i className="fas fa-camera"></i>
                                </button>
                            )
                        )}
                    </div>
                </div>
            );
        };

        // Bottom Navigation Component
        const BottomNavigation = ({ currentTab, onTabChange, missingCount }) => {
            const tabs = [
                { id: 'home', label: 'ស្វែងរក', icon: 'fa-search' },
                { id: 'missing', label: 'រង់ចាំ', icon: 'fa-camera', badge: missingCount },
                { id: 'delete', label: 'លុប', icon: 'fa-trash-alt' },
                { id: 'admin', label: 'គ្រប់គ្រង', icon: 'fa-user-circle' }
            ];
            
            return (
                <div className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-40">
                    <div className="max-w-4xl mx-auto">
                        <div className="grid grid-cols-4 h-16">
                            {tabs.map(tab => (
                                <button
                                    key={tab.id}
                                    onClick={() => onTabChange(tab.id)}
                                    className={`flex flex-col items-center justify-center relative transition-colors ${
                                        currentTab === tab.id 
                                            ? 'text-indigo-600' 
                                            : 'text-gray-400 hover:text-gray-600'
                                    }`}
                                >
                                    <div className={`w-10 h-10 rounded-full flex items-center justify-center transition-all ${
                                        currentTab === tab.id 
                                            ? 'bg-indigo-100' 
                                            : 'hover:bg-gray-100'
                                    }`}>
                                        <i className={`fas ${tab.icon} text-lg`}></i>
                                    </div>
                                    <span className="text-xs mt-1 font-medium khmer-text">{tab.label}</span>
                                    {tab.badge && tab.badge > 0 && (
                                        <span className="absolute top-1 right-1/4 bg-red-500 text-white text-xs w-5 h-5 flex items-center justify-center rounded-full">
                                            {tab.badge > 99 ? '99+' : tab.badge}
                                        </span>
                                    )}
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // Admin Panel Component
        const AdminPanel = ({ admin, logs, onLogout, onDeleteLog }) => {
            return (
                <div className="max-w-4xl mx-auto px-4 py-6">
                    <div className="admin-card overflow-hidden">
                        <div className="p-6 text-white">
                            <div className="flex justify-between items-start">
                                <div>
                                    <h2 className="text-2xl font-bold mb-1 khmer-text">ផ្ទាំងគ្រប់គ្រង</h2>
                                    <p className="text-gray-300 khmer-text">ចូលជា: <span className="font-semibold">{admin.name}</span></p>
                                </div>
                                <button 
                                    onClick={onLogout}
                                    className="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2"
                                >
                                    <i className="fas fa-sign-out-alt"></i>
                                    ចាកចេញ
                                </button>
                            </div>
                            
                            <div className="mt-6 grid grid-cols-1 sm:grid-cols-3 gap-4">
                                <div className="stat-card p-4 text-center">
                                    <div className="text-3xl font-bold">{logs.length}</div>
                                    <div className="text-sm text-gray-300 mt-1 khmer-text">ចំនួនថតសំបុត្រ</div>
                                </div>
                                <div className="stat-card p-4 text-center">
                                    <div className="text-3xl font-bold">{admin.id}</div>
                                    <div className="text-sm text-gray-300 mt-1 khmer-text">លេខសម្គាល់អ្នកគ្រប់គ្រង</div>
                                </div>
                                <div className="stat-card p-4 text-center">
                                    <div className="text-3xl font-bold">{new Date().toLocaleDateString()}</div>
                                    <div className="text-sm text-gray-300 mt-1 khmer-text">កាលបរិច្ឆេទថ្ងៃនេះ</div>
                                </div>
                            </div>
                        </div>
                        
                        <div className="p-6 bg-white">
                            <h3 className="text-lg font-semibold text-gray-800 mb-4 khmer-text">សកម្មភាពថ្មីៗ</h3>
                            
                            {logs.length === 0 ? (
                                <div className="text-center py-8">
                                    <div className="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <i className="fas fa-history text-2xl text-gray-400"></i>
                                    </div>
                                    <p className="text-gray-500 khmer-text">មិនមានសកម្មភាពថ្មីៗ</p>
                                </div>
                            ) : (
                                <div className="space-y-3 max-h-96 overflow-y-auto custom-scrollbar">
                                    {logs.map(log => (
                                        <div key={log.key} className="bg-gray-50 rounded-lg p-4 flex justify-between items-center hover:bg-gray-100 transition-colors">
                                            <div>
                                                <p className="font-medium text-gray-800 khmer-text">{log.studentName}</p>
                                                <p className="text-sm text-gray-500">ID: {log.studentId}</p>
                                            </div>
                                            <div className="flex items-center gap-3">
                                                <span className="text-sm text-gray-500">
                                                    {new Date(log.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                                                </span>
                                                <button 
                                                    onClick={() => onDeleteLog(log.key)}
                                                    className="text-gray-400 hover:text-red-500 transition-colors"
                                                >
                                                    <i className="fas fa-times"></i>
                                                </button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // Camera Modal Component
        const CameraModal = ({ videoRef, canvasRef, isMirrored, onClose, onCapture, onToggleMirror }) => {
            return (
                <div className="fixed inset-0 bg-black z-50 flex flex-col justify-center items-center">
                    <div className="absolute top-0 w-full p-6 flex justify-between items-center z-10">
                        <button 
                            onClick={onClose}
                            className="text-white bg-white/20 backdrop-blur-md p-3 rounded-full hover:bg-white/30 transition-colors"
                        >
                            <i className="fas fa-times"></i>
                        </button>
                        <span className="text-white font-medium text-sm bg-black/50 px-4 py-1.5 rounded-full backdrop-blur-md khmer-text">
                            របៀបការេ
                        </span>
                        <div className="w-10"></div>
                    </div>
                    
                    <div className="relative w-full max-w-md aspect-square bg-black overflow-hidden">
                        <video 
                            ref={videoRef}
                            autoPlay 
                            playsInline 
                            className={`w-full h-full object-cover ${isMirrored ? 'scale-x-[-1]' : ''}`}
                        />
                        <canvas ref={canvasRef} className="hidden" />
                        
                        <div className="camera-overlay">
                            <div className="focus-frame">
                                <div className="focus-corner tl"></div>
                                <div className="focus-corner tr"></div>
                                <div className="focus-corner bl"></div>
                                <div className="focus-corner br"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div className="absolute bottom-0 w-full p-8 bg-gradient-to-t from-black via-black/80 to-transparent flex justify-around items-center">
                        <button 
                            onClick={onToggleMirror}
                            className="text-white/80 p-4 hover:text-white transition-colors flex flex-col items-center gap-1"
                        >
                            <i className="fas fa-exchange-alt text-xl"></i>
                            <span className="text-xs uppercase tracking-wider khmer-text">បញ្ច្រាស</span>
                        </button>
                        
                        <button 
                            onClick={onCapture}
                            className="w-20 h-20 bg-white rounded-full border-4 border-gray-400 flex items-center justify-center transform active:scale-90 transition-all shadow-[0_0_20px_rgba(255,255,255,0.3)] pulse"
                        >
                            <div className="w-16 h-16 bg-white rounded-full border border-gray-300"></div>
                        </button>
                        
                        <div className="w-16 h-16 flex items-center justify-center">
                            {/* Placeholder for gallery button */}
                        </div>
                    </div>
                </div>
            );
        };

        // Preview Modal Component
        const PreviewModal = ({ image, studentName, isUploading, onClose, onConfirm, onRetake }) => {
            return (
                <div className="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 modal-overlay">
                    <div className="bg-white w-full max-w-md rounded-2xl overflow-hidden shadow-2xl flex flex-col slide-up">
                        <div className="p-4 border-b flex justify-between items-center bg-gray-50">
                            <h3 className="font-semibold text-gray-800 khmer-text">មើលរូបភាពមុន</h3>
                            <button 
                                onClick={onClose}
                                className="text-gray-400 hover:text-gray-600 transition-colors"
                            >
                                <i className="fas fa-times"></i>
                            </button>
                        </div>
                        
                        <div className="p-6 bg-gray-100 flex items-center justify-center">
                            <img src={image} alt={studentName} className="w-full aspect-square object-cover rounded-xl shadow-lg" />
                        </div>
                        
                        <div className="p-4 space-y-3 bg-white border-t">
                            <p className="text-center text-gray-700 font-medium khmer-text">{studentName}</p>
                            
                            <button 
                                onClick={onConfirm}
                                disabled={isUploading}
                                className="w-full btn-primary disabled:bg-indigo-400 text-white font-medium py-3 rounded-xl flex items-center justify-center gap-2 khmer-text"
                            >
                                {isUploading ? (
                                    <>
                                        <div className="loader"></div>
                                        កំពុងផ្ទុកឡើង...
                                    </>
                                ) : (
                                    <>
                                        <i className="fas fa-check-circle"></i>
                                        បញ្ជាក់ & រក្សាទុក
                                    </>
                                )}
                            </button>
                            
                            <button 
                                onClick={onRetake}
                                disabled={isUploading}
                                className="w-full bg-gray-100 hover:bg-gray-200 disabled:bg-gray-100 text-gray-700 font-medium py-3 rounded-xl transition-colors khmer-text"
                            >
                                ថតម្ដងទៀត
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // Delete Modal Component
        const DeleteModal = ({ studentName, onClose, onConfirm }) => {
            return (
                <div className="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 modal-overlay">
                    <div className="bg-white w-full max-w-sm rounded-2xl shadow-2xl overflow-hidden p-6 text-center slide-up">
                        <div className="w-16 h-16 bg-red-100 text-red-500 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i className="fas fa-trash-alt text-2xl"></i>
                        </div>
                        
                        <h3 className="text-xl font-semibold text-gray-800 mb-2 khmer-text">លុបរូបភាព?</h3>
                        <p className="text-gray-500 mb-6 khmer-text">
                            តើអ្នកប្រាកដជាចង់លុបរូបភាពសម្រាប់ <span className="font-semibold">{studentName}</span> ឬ?
                        </p>
                        
                        <div className="flex gap-3">
                            <button 
                                onClick={onClose}
                                className="flex-1 py-3 rounded-xl bg-gray-100 text-gray-700 font-medium hover:bg-gray-200 transition-colors khmer-text"
                            >
                                បោះបង់
                            </button>
                            <button 
                                onClick={onConfirm}
                                className="flex-1 py-3 rounded-xl btn-danger text-white font-medium khmer-text"
                            >
                                លុប
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // Success Modal Component
        const SuccessModal = () => {
            return (
                <div className="fixed inset-0 bg-black/20 z-50 flex items-center justify-center p-4 modal-overlay">
                    <div className="bg-white rounded-2xl px-8 py-6 shadow-2xl flex flex-col items-center slide-up">
                        <div className="w-16 h-16 bg-green-100 text-green-500 rounded-full flex items-center justify-center mb-4">
                            <i className="fas fa-check text-2xl"></i>
                        </div>
                        <h3 className="font-semibold text-gray-800 text-lg khmer-text">ជោគជ័យ!</h3>
                        <p className="text-gray-500 text-center mt-2 khmer-text">រូបភាពត្រូវបានផ្ទុកឡើងដោយជោគជ័យ</p>
                    </div>
                </div>
            );
        };

        // Render the App
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>